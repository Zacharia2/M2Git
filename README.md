# MGit
![GitHub Downloads (all assets, all releases)](https://img.shields.io/github/downloads/Zacharia2/MGit/total)

MGit是一款Git客户端安卓应用。（Version ≥ Android 12）。拥有常用的拉取、推送、提交、合并、克隆、比较、衍合、择取、创建新的分支、添加本地仓库、重置更改等等功能。当前维护者为 maks/MGit，此分支的设计意义和目标是填补Android平台上对Git知识库同步功能的空白。

## 快速开始

### 使用多远程同步

增加功能：同步、撤销提交、Tokens设置、默认仓库目录，并所有依赖的软件包进行升级。修复暂存所有文件过慢问题、修复inlater has been closed导致的解压缩问题、修复 avatar 全球通用头像、修复仓库列表打开远程地址问题、修改提交命令中的暂存所有已跟踪的文件选项为暂存所有文件选项，减少一步暂存所有文件的步骤，以及优化一些使用体验等等。2025.12.17：默认外部存储、本地lfs不支持克隆拉取lfs、webdav 服务、下拉刷新状态、新的异步任务、升级jgit、验证凭证管理器逻辑、变更包名

MGit+Gitee用来同步obsidian、logseq等笔记库非常迅速且附加历史版本，可以随时回滚查看历史记录。国内推荐使用Gitee作为同步使用的默认远程仓库；用Github作为工作和备份用的远程仓库，可定时用桌面端Git命令进行同步。在桌面端使用git remote add添加多远程仓库Gitee和Github。移动端只使用默认默认的Gitee远程仓库，安装并打开MGit，点击顶部导航栏右侧菜单中的设置，配置Git用户名和用户邮箱。若你的仓库是私有的，则需要配置token账户和token秘钥。Token在Gitee中点击`用户头像-设置-令牌`，然后点击生成令牌。此令牌专用于访问你的私有库。设置好后，点击导航栏最右侧菜单、点击克隆、填入克隆地址，等待克隆完成。你也可以选择导入，在导入时勾选导入为外部仓库。外部仓库和内部仓库的区别在于是否存储在软件自己的内部存储私有目录中，内部存储私有目录一般可以看做：`data/data/package_name`、`android/data/package_name`。

![image](https://github.com/user-attachments/assets/e90b58aa-e368-4939-ba3e-254c0bcebd8e)

在仓库列表中，点击仓库可以进入仓库详情页，在详情页可以左右滑动，从左到右分别有三个页面依次为：文件、提交、状态。可以在文件查看仓库中的文件，在提交可以查看提交的历史，在状态可以查看修改。一般使用状态查看修改状态，点击未暂存DIFF可以看到有没有修改的还没暂存的文件。我通常会使用仓库详情页中导航栏中最右侧的菜单按钮，打开后点击同步按钮，然后直接按照同步策略进行同步。现在好好享用安卓版本的快速同步功能吧！

### 克隆远程仓库

1. 点击`+`图标添加新仓库
2. 输入远程URL（见下面的URL格式）
3. 输入本地仓库名称 - 注意这**不是**完整路径，因为MGit将所有仓库存储在同一个本地目录中（可以在MGit设置中更改）
4. 点击`Clone`按钮
5. 如果需要，系统会提示您输入连接到远程仓库的凭据。MGit会将仓库（所有分支）下载到您的设备上

### 创建本地仓库

1. 点击`+`图标添加新仓库
2. 点击`Init Local`创建本地仓库
3. 当提示时，输入该仓库的名称
4. 将创建一个本地的空仓库

### URL格式

#### SSH URL

* 运行在标准端口（22）的SSH：`ssh://username@server_name/path/to/repo`
* 运行在非标准端口的SSH：`ssh://username@server_name:port/path/to/repo`
* 需要填写`username` - 默认情况下，MGit会尝试以root身份连接。

#### HTTP(S) URL

* HTTP(S) URL：`https://server_name/path/to/repo`

## WebDav

配合WebDav客户端（RaiDrive）使用，可在任意安全的局域网环境中将手机挂载为网络磁盘。

以下是对 M2Git WebDav 的功能评估，以及基于 WebDAV 协议功能清单提供的新版详细功能实现对比表。

| 大类                             | 小类                   | 功能项             | 对应RFC/标准       | 功能描述                                                                                    | 普遍支持度/说明    | **M2Git 实现情况**                                                                    |
| :------------------------------- | :--------------------- | :----------------- | :----------------- | :------------------------------------------------------------------------------------------ | :----------------- | :------------------------------------------------------------------------------------ |
| 核心基础协议 (RFC 4918 – WebDAV) | **1.1 资源与集合管理** | 基本方法           | RFC 4918           | `MKCOL`（创建集合）、`PUT` / `DELETE` / `COPY` / `MOVE`                                     | **核心必备**       | ✔️ 完整实现文件、目录的创建、删除、复制、移动操作。                                    |
|                                  |                        | 集合成员枚举       | RFC 4918           | `PROPFIND` 方法配合 `Depth: 1` 或 `infinity`，列出集合目录内容                              | **核心必备**       | ✔️ 使用 `FsDirectoryResource` 提供目录内容枚举，但深度枚举尚无限制，可能出现性能问题。 |
|                                  |                        | 覆盖行为与前置条件 | RFC 4918           | `Overwrite: T` 头, `If-Match`, `If-None-Match` 条件操作                                     | **核心必备**       | ❌ 条件请求未实现，覆盖行为受限；缺少对操作安全性的前置处理，可导致数据竞争冲突。      |
|                                  | **1.2 属性管理**       | 死属性与活属性     | RFC 4918           | **死属性**：客户端自定义元数据；**活属性**：由服务器管理，自动填充如文件大小/创建时间等信息 | **核心必备**       | ⚠️ 仅支持简单属性读写，活属性如`creationdate`未完全实现。                              |
|                                  |                        | 属性操作方法       | RFC 4918           | `PROPFIND`（查询）和 `PROPPATCH`（设置/删除）                                               | **核心必备**       | ✔️ 属性操作基本支持，大部分资源可完成属性读写；未支持`allprop`类型的请求细化。         |
|                                  |                        | 关键活属性         | RFC 4918           | 如 `creationdate`, `getetag` 等属性，服务器生成基础资源元数据                               | **实践必备**       | ⚠️ 部分活属性支持有限，ETag 生成未标准化（目前未使用唯一文件哈希生成）。               |
|                                  | **1.3 锁机制**         | 锁类型与方法       | RFC 4918           | 支持**共享锁**和**互斥锁**，包括 `LOCK`、`UNLOCK` 基本方法                                  | **核心必备**       | ✔️ 基于 `FsMemoryLockManager` 提供稳定的资源锁支持。                                   |
|                                  |                        | 锁发现与超时       | RFC 4918           | `lockdiscovery` 属性，通知现有锁；`Timeout` 请求头用于设置限时锁。                          | **核心必备**       | ⚠️ 锁超时机制有限，部分锁刷新需求未覆盖；锁发现功能支持未完全实现。                    |
| 官方扩展协议 (RFC 标准)          | **2.1 访问控制列表**   | WebDAV ACL         | RFC 3744           | 基于角色的资源权限控制，通过 `DAV:acl` 属性进行精细化权限定义。                             | **企业级重要可选** | ❌ 未实现 ACL 和用户角色的精细化权限分配功能。                                         |
|                                  | **2.2 有序集合**       | 集合排序           | RFC 3648           | 在集合中维护资源显示顺序，支持排序优先级。                                                  | **可选**           | ❌ 无集合排序功能，未实现 `ordering-type` 属性支持。                                   |
|                                  | **2.3 绑定**           | 资源多位置引用     | RFC 5842           | 类似硬链接，一个资源可被多个集合引用，支持 `BIND` 和 `UNBIND` 方法操作。                    | **可选**           | ❌ 多 URI 映射和硬链接未支持，资源无法实现多入口访问。                                 |
|                                  | **2.4 版本控制**       | Delta-V            | RFC 3253           | 提供版本历史跟踪及协作分支操作（如 `CHECKIN`、`CHECKOUT`）。                                | **高级可选**       | ❌ 完全缺失版本管理功能，无文件历史存储，无操作分支支持机制。                          |
|                                  | **2.5 集合同步**       | 同步协议           | RFC 6578           | 通过同步令牌（`sync-token`）记录集合增量变化，支持同步更新。                                | **现代功能常用**   | ❌ 无增量同步支持；未实现同步令牌，无法检测更新状态。                                  |
|                                  | **2.6 搜索**           | DASL               | RFC 5323           | 使用 `SEARCH` 方法按文件属性或关键词查询资源。                                              | **高级可选**       | ❌ 无搜索功能，资源查询能力缺失，无法按属性或元数据筛选文件。                          |
|                                  | **2.7 扩展集合创建**   | 扩展 MKCOL         | RFC 5689           | 扩展创建集合的能力，包括指定属性和初始化资源类型。                                          | **可选**           | ❌ 集合创建未提供初始属性设置能力，无法实现扩展型集合创建。                            |
| HTTP/1.1基础与 WebDAV 特定行为   | **3.1 方法发现**       | OPTIONS 方法       | RFC 7231, 4918     | 声明服务器的可支持功能，例如返回 `DAV` 标头中识别支持的扩展版本。                           | **必备**           | ✔️ OPTIONS 方法支持基本能力声明，未包含明确扩展声明，如高级协议支持能力。              |
|                                  | **3.2 条件请求**       | If 头扩展          | RFC 4918           | 基于锁令牌或文件版本的条件请求头（`If` 头扩展），防止竞争写入或冲突覆盖。                   | **核心功能**       | ❌ 条件请求功能完全缺失，资源更新操作存在冲突风险。                                    |
|                                  | **3.3 内容传输**       | 部分内容传输       | RFC 7233           | `Range` / `Content-Range` 允许流式传输或断点续传大文件。                                    | **核心功能**       | ✔️ 文件分块传输功能完整，部分内容传输和断点续传实现，但尚未并发优化。                  |
|                                  | **3.4 缓存与验证**     | 缓存控制           | RFC 7234           | 使用 ETag 和 `Last-Modified` 确保客户端正常缓存和验证资源版本。                             | **重要功能**       | ⚠️ 基本支持 ETag 和 `Last-Modified`，但生成值稳定性和唯一性不足。                      |
|                                  | **3.5 状态码**         | WebDAV 状态码      | RFC 4918           | 支持 WebDAV 扩展状态码，例如 207、422、423、507 等。                                        | **核心功能**       | ⚠️ 状态码支持部分实现，部分客户端期望状态码（如 423 锁定）尚未完善处理逻辑。           |
| 实践扩展与互操作性约定           | **4.2 配额与存储报告** | 配额属性           | 自定义/`DAV:` 扩展 | 提供磁盘空间限制或存储监控，如 quota-available-bytes 或使用限额报告。                       | **企业功能常见**   | ✔️ 基本实现磁盘空间报告功能                                                            |
|                                  | **4.3 主流兼容性**     | Windows 网盘       | Microsoft 要求     | 确保资源兼容 Windows 的 WebDAV 网盘映射方式（`net use` 方法）。                             | **重要**           | ⚠️ 基本支持 Windows 网络驱动映射，但存在部分兼容性细节问题。                           |
|                                  |                        | macOS Finder       | Apple 要求         | 确保目录在 Finder 应用中的正常展示，包括 `.DS_Store` 支持。                                 | **重要**           | ⚠️ macOS 的 Finder 支持基础功能，但深度交互优化缺失。                                  |
|                                  | **4.4 现代安全**       | HTTPS 强制         | 安全最佳实践       | 强制加密传输，将所有 HTTP 请求转为 HTTPS。                                                  | **生产环境必须**   | ❌ 未强制支持 HTTPS 或加密传输，传输安全性薄弱。                                       |


# 许可证

请参阅 [GPLv3](./LICENSE) 由`maks@manichord.com`编写的所有代码，您可以选择也可以在[MIT许可证](https://en.wikipedia.org/wiki/MIT_License)下使用。

